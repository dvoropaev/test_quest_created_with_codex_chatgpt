# Техническое задание: Система сражений

## 1. Общие положения
- Боевая система должна сочетать стратегическую пошаговость и элементы экшена.
- В основе лежит конечный автомат с фазами: подготовка, действия игрока, действия противника, расчёт последствий.
- Интерфейс боёв интегрируется с движком и не использует сторонних библиотек.
- Боевая логика вынесена в модуль `BattleManager`, который управляет очередностью ходов и применением эффектов.
- Система событий отправляет уведомления о начале и завершении боя, позволяя синхронизировать анимации и скрипты.
- В каждом бою учитываются условия местности, влияющие на точность и скорость перемещения.

## 2. Характеристики и параметры
- Базовые параметры персонажей: здоровье, энергия, сила атаки, защита, инициативность.
- Дополнительные статусы: "оглушение", "критический удар", "уклонение" и прочие модификаторы.
- Показатели хранятся в объекте `BattleStats` и изменяются через методы боевой системы.
- Формула урона учитывает базовый урон оружия, силу атаки, бонусы навыков и уровень защиты противника.
- Инициатива зависит от скорости и активных модификаторов, определяя порядок ходов в раунде.
- Эффекты статусов имеют длительность в ходах и могут складываться или нейтрализовать друг друга.
- При изменении характеристик отображается всплывающая подсказка с величиной бонуса или штрафа.

## 3. Типы атак и действий
- Обычные удары ближнего и дальнего боя, использование оружия и магических приёмов.
- Специальные навыки расходуют энергию и могут накладывать статусы на врагов.
- Доступные действия игрока выводятся в виде кнопок или элементов меню.
- Система блокирования и парирования снижает получаемый урон, расходуя энергию.
- Заряженные атаки наносят повышенный урон после накопления очков комбо.
- Приёмы взаимодействуют с окружением: можно взрывать бочки или сбивать препятствия на врага.
- Некоторые умения открывают возможность временно обезоружить противника или уклониться от всей очереди атак.

## 4. Прокачка и инвентарь
- Оружие и снаряжение дают бонусы к урону и защите, содержат слоты для улучшений.
- Навыки делятся на ветви: владение мечом, стрельба, магия, техника.
- Новые умения открываются при повышении соответствующих характеристик или при завершении квестов.
- Дерево навыков содержит не менее трёх ветвей, каждая из которых имеет десять уровней развития.
- Система модификаций оружия позволяет вставлять руны или технологические модули, усиливая характеристики.
- Предусмотрено создание предметов по рецептам с использованием редких материалов из побочных квестов.
- Максимальный уровень развития каждой ветви навыков ограничен десятым уровнем, после чего открывается уникальная специализация.

## 5. Искусственный интеллект
- Поведение противников задаётся скриптами: агрессивный, оборонительный, поддержка союзников.
- Алгоритм ИИ учитывает текущие показатели героя и состояние поля боя.
- Возможны уникальные боссы со своими правилами и фазами сражения.
- В основе ИИ лежит иерархический конечный автомат с возможностью подстройки сложности под стиль игрока.
- Бои с боссами переключаются на новые фазы при достижении определённых порогов здоровья.
- ИИ анализирует предыдущие действия игрока и пытается контратаковать наиболее часто используемые приёмы.

## 6. Пользовательский интерфейс
- На экране отображаются полосы здоровья, энергии и активные эффекты для всех участников.
- Важные события (критические удары, уклонения, получение статусов) подсвечиваются анимациями.
- Предусмотрены текстовые подсказки при первом столкновении с новым типом врага.
- Игрок может переназначать горячие клавиши для основных действий и выбора целей.
- Всплывающие подсказки сообщают о слабых сторонах противников и рекомендуемых тактиках.
- Для удобства предусмотрен журнал последних действий, который можно пролистывать во время паузы.

## 7. Дополнительные механики
- Система комбо: последовательные успешные удары увеличивают урон.
- Возможность временно замедлять время для выбора действия при достаточном уровне навыка.
- Поддержка многопользовательских дуэлей через локальное соединение в последующих версиях.
- Режим "берсерк" активируется при низком уровне здоровья, усиливая урон и скорость атаки.
- Синергия навыков: сочетание определённых умений повышает их общий эффект.
- Тип поверхности и препятствия на поле боя влияют на шанс попадания и скорость передвижения.
- При успешном выполнении серии комбо восполняется небольшое количество энергии.

## 8. Разнообразие тактик
- Игрок свободно комбинирует оружие ближнего и дальнего боя, создавая собственные связки.
- Предусмотрено не менее четырёх классов умений: физические, магические, технологические и поддержка.
- Разные противники обладают уникальными уязвимостями, требующими менять стратегию в бою.
- Использование укрытий и разрушаемых объектов позволяет маневрировать и менять позиции.
- Тактическая пауза даёт время на планирование цепочки действий и выбор цели.
- Противники адаптируются к повторяющимся приёмам игрока, заставляя искать новые подходы.
- Система достижений поощряет нестандартные и рискованные стратегии.
- Герой может временно сменить стиль боя, переключаясь между оборонительным и агрессивным режимами.

